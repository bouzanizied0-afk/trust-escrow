<!DOCTYPE html>
<html lang="en">
<head>
    <base target="_self">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Professional Trading Platform</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
    <script>
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        primary: "#3B82F6",
                        dark: { 900: "#111827", 800: "#1f2937", 700: "#374151" }
                    },
                    spacing: { "sidebar": "280px", "sidebar-collapsed": "80px" }
                }
            }
        }
    </script>
    <style>
        .sidebar-transition { transition: width 0.3s ease, transform 0.3s ease; }
        .nav-item.active { border-left: 3px solid #3B82F6; background: rgba(59, 130, 246, 0.1); }
        @media (max-width: 1023px) {
            #sidebar { transform: translateX(-100%); position: fixed; z-index: 50; }
            #sidebar.open { transform: translateX(0); }
            .overlay.active { display: block; position: fixed; inset: 0; background: rgba(0,0,0,0.5); z-index: 40; }
        }
    </style>
</head>
<body class="min-h-screen bg-gray-50 dark:bg-dark-900 text-gray-800 dark:text-gray-200">
   <div class="overlay" id="mobileOverlay"></div> 
   
   <aside id="sidebar" class="sidebar-transition fixed left-0 top-0 h-screen bg-white dark:bg-dark-800 shadow-lg z-50 w-sidebar-collapsed lg:w-sidebar flex flex-col">
        <div class="p-4 border-b dark:border-dark-700 flex items-center justify-between">
            <div class="flex items-center space-x-3">
                <div class="w-10 h-10 rounded-lg bg-primary flex items-center justify-center"><i class="fas fa-cube text-white text-xl"></i></div>
                <span class="text-xl font-bold hidden lg:inline-block">UniversalPro</span>
            </div>
        </div>
        
        <nav class="flex-1 overflow-y-auto py-6">
            <ul class="space-y-2 px-4">
                <li><a href="#" data-section="dashboard" class="nav-item active flex items-center space-x-4 p-3 rounded-lg"><i class="fas fa-home w-6"></i><span class="hidden lg:inline-block">Home</span></a></li>
                <li><a href="#" id="p2p-nav-btn" data-section="p2p" class="nav-item flex items-center space-x-4 p-3 rounded-lg"><i class="fas fa-exchange-alt w-6"></i><span class="hidden lg:inline-block">P2P Trading</span></a></li>
                <li><a href="#" data-section="settings" class="nav-item flex items-center space-x-4 p-3 rounded-lg"><i class="fas fa-cog w-6"></i><span class="hidden lg:inline-block">Settings</span></a></li>
            </ul>
        </nav>
   </aside>
    
    <main id="mainContent" class="min-h-screen lg:ml-sidebar-collapsed xl:ml-sidebar">
        <header class="bg-white dark:bg-dark-800 shadow-sm sticky top-0 z-40 p-4 flex justify-between">
            <button id="mobileMenuToggle" class="lg:hidden"><i class="fas fa-bars"></i></button>
            <h1 id="pageTitle" class="text-xl font-bold">Dashboard</h1>
            <button id="themeToggle"><i class="fas fa-moon"></i></button>
        </header>
        
        <div class="p-4" id="mainContentArea">
            <section id="dashboard" class="content-section animate-fade-in">
                <h2 class="text-2xl font-bold">Welcome Home</h2>
                <p>Select P2P Trading from the sidebar to see the magic.</p>
            </section>

            <section id="p2p" class="content-section hidden animate-fade-in min-h-[80vh]"></section>
            
            <section id="settings" class="content-section hidden animate-fade-in"><h2>Settings Page</h2></section>
        </div>
    </main>

    <script>
        // نظام التنقل الأساسي
        const navItems = document.querySelectorAll(".nav-item");
        const contentSections = document.querySelectorAll(".content-section");
        const pageTitle = document.getElementById("pageTitle");

        function switchSection(sectionId) {
            navItems.forEach(item => item.classList.toggle("active", item.getAttribute("data-section") === sectionId));
            contentSections.forEach(section => {
                section.classList.toggle("hidden", section.id !== sectionId);
                section.classList.toggle("active", section.id === sectionId);
            });
            pageTitle.textContent = sectionId.toUpperCase();
        }

        navItems.forEach(item => {
            item.addEventListener("click", (e) => {
                e.preventDefault();
                switchSection(item.getAttribute("data-section"));
            });
        });

        // محرك جلب P2P الديناميكي
        async function loadP2PComponent() {
            const p2pSection = document.getElementById('p2p');
            if (p2pSection.innerHTML.trim() === "") {
                try {
                    p2pSection.innerHTML = "<div class='p-10 text-center'>Loading P2P System...</div>";
                    const response = await fetch('p2p.html');
                    const html = await response.text();
                    p2pSection.innerHTML = html;

                    // تشغيل السكريبتات المحقونة
                    const scripts = p2pSection.querySelectorAll('script');
                    scripts.forEach(oldScript => {
                        const newScript = document.createElement('script');
                        newScript.textContent = oldScript.textContent;
                        document.body.appendChild(newScript);
                    });
                } catch (err) {
                    p2pSection.innerHTML = "<p class='text-red-500'>Error: Could not load p2p.html</p>";
                }
            }
        }

        document.getElementById('p2p-nav-btn').addEventListener('click', loadP2PComponent);

        // Dark Mode Toggle
        const themeToggle = document.getElementById("themeToggle");
        themeToggle.addEventListener("click", () => {
            document.documentElement.classList.toggle("dark");
        });

        // Mobile Menu Toggle
        const mobileMenuToggle = document.getElementById("mobileMenuToggle");
        const sidebar = document.getElementById("sidebar");
        mobileMenuToggle.addEventListener("click", () => sidebar.classList.toggle("open"));
    </script>
</body>
</html>
