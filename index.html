<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>QUP Command Center - Sovereign Edition</title>
    <style>
        :root {
            --green: #2ecc71; --red: #e74c3c; --blue: #3498db; --dark: #0a0a0a;
            --neon-green: #39ff14;
        }
        body {
            margin: 0; background-color: var(--dark); color: white;
            font-family: 'Courier New', Courier, monospace;
            display: flex; flex-direction: column; align-items: center;
            overflow: hidden;
        }

        /* Ø§Ù„Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø±Ù‚Ù…ÙŠ Ø§Ù„Ø¶Ø®Ù… */
        #main-counter {
            font-size: 5rem; font-weight: 900; color: var(--neon-green);
            text-shadow: 0 0 20px rgba(57, 255, 20, 0.5);
            margin: 10px 0; font-family: 'Digital-7', monospace;
            letter-spacing: 5px;
        }

        .container {
            display: grid; grid-template-columns: 1fr 380px;
            gap: 15px; width: 98%; height: 75vh;
        }

        /* Ø´Ø§Ø´Ø© Ø§Ù„Ù…ÙŠØ¯ÙŠØ§ */
        .tv-screen {
            background: #000; border: 2px solid #222; border-radius: 5px;
            position: relative; display: flex; align-items: center; justify-content: center;
            box-shadow: inset 0 0 100px rgba(0,0,0,1);
        }
        #tv-image, #tv-video { 
            max-width: 95%; max-height: 95%; display: none; z-index: 10;
            border: 1px solid #444; 
        }
        
        /* Ø§Ù„Ø±Ø§Ø¯Ø§Ø± Ø§Ù„Ù„Ø­Ø¸ÙŠ */
        #radar-canvas { 
            position: absolute; top:0; left:0; width: 100%; height: 100%; 
            opacity: 0.4; z-index: 1; pointer-events: none;
        }

        .side-panel { display: flex; flex-direction: column; gap: 10px; }
        
        /* Ø³Ø¬Ù„ Ø§Ù„Ù†Ø¨Ø¶Ø§Øª */
        .chat-area {
            flex-grow: 1; background: rgba(0,20,0,0.9); border: 1px solid var(--green);
            border-radius: 4px; padding: 10px; overflow-y: auto;
            font-size: 0.8rem; color: var(--green); box-shadow: 0 0 10px rgba(0,255,0,0.1);
        }

        .controls { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
        
        button {
            padding: 12px; cursor: pointer; border: 1px solid rgba(255,255,255,0.1); 
            border-radius: 3px; font-weight: bold; text-transform: uppercase;
        }
        .btn-send { background: var(--green); color: #000; }
        .btn-delete { background: transparent; color: var(--red); border: 1px solid var(--red); }
        .btn-file { background: var(--blue); color: white; }

        .status-header {
            width: 100%; background: #111; padding: 10px 20px;
            display: flex; justify-content: space-between; align-items: center;
            border-bottom: 1px solid #333;
        }
        #status-light { 
            width: 12px; height: 12px; border-radius: 50%; background: red;
            box-shadow: 0 0 10px red; transition: 0.5s;
        }
    </style>
</head>
<body>

    <div class="status-header">
        <div style="display: flex; align-items: center; gap: 12px;">
            <div id="status-light"></div>
            <span id="status-text" style="font-size: 0.8rem; color: #aaa;">DISCONNECTED</span>
        </div>
        <div style="color: var(--blue); font-size: 0.9rem;">
            PULSE LOAD: <span id="percent">0%</span>
        </div>
    </div>

    <div id="main-counter">000000</div>

    <div class="container">
        <div class="tv-screen">
            <canvas id="radar-canvas"></canvas>
            <img id="tv-image">
            <video id="tv-video" controls autoplay></video>
            <div id="tv-placeholder" style="color: #222; font-size: 1.5rem; z-index: 0;">WAITING FOR ATOMIC STREAM...</div>
        </div>

        <div class="side-panel">
            <div class="chat-area" id="chat-box">
                <div>>> INITIALIZING QUP SOVEREIGN ENGINE...</div>
            </div>
            
            <input type="file" id="fileInput" style="display: none;">
            
            <div class="controls">
                <button class="btn-file" onclick="document.getElementById('fileInput').click()">ğŸ“‚ Ø§Ø®ØªÙŠØ§Ø± Ù…Ù„Ù</button>
                <button class="btn-send" id="sendBtn">ğŸš€ Ø¨Ø« Ø§Ù„Ù†Ø¨Ø¶Ø©</button>
                <button class="btn-delete" id="clearBtn">ğŸ—‘ Ù…Ø³Ø­ Ø§Ù„Ø³Ø­Ø§Ø¨</button>
                <button class="btn-delete" id="resetUI" style="color: #ccc; border-color: #444;">ğŸ”„ Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ†</button>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getDatabase, ref, onValue, set, remove } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-database.js";

        // Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª ÙÙŠØ±Ø¨Ø§ÙŠØ³ Ø§Ù„Ø®Ø§ØµØ© Ø¨Ùƒ
        const firebaseConfig = {
            apiKey: "AIzaSyAZs0bb_t-bzMtaJqy_W_QDBSdQKHLEiD4",
            authDomain: "ziedzizou-7b74d.firebaseapp.com",
            databaseURL: "https://ziedzizou-7b74d-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "ziedzizou-7b74d",
            storageBucket: "ziedzizou-7b74d.firebasestorage.app",
            messagingSenderId: "937969676323",
            appId: "1:937969676323:web:8c89472de068a2e6cd0196",
            measurementId: "G-WQR9DXYGPS"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
        const streamRef = ref(db, 'QUP_UNIVERSAL_STREAM');

        // ØªØµØ¯ÙŠØ± Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª Ù„Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø¹Ø§Ù„Ù…ÙŠ (Global) Ù„ØªØ¹Ù…Ù„ Ù…Ø¹ Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ø®Ø§Ø±Ø¬ÙŠØ©
        window.fbSet = (data) => set(streamRef, data);
        window.streamRef = streamRef;
        window.db = db;

        // Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ù…Ù†Ø·Ù‚ Ø§Ù„Ù…Ø­Ø±Ùƒ ÙˆØ§Ù„Ù…Ø³ØªÙ‚Ø¨Ù„
        import { QUP_Core } from './QUP_Core.js';
        import './QUP_Receiver_Ultimate.js';

        const light = document.getElementById('status-light');
        const text = document.getElementById('status-text');
        const mainCounter = document.getElementById('main-counter');

        // Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ø§ØªØµØ§Ù„
        onValue(ref(db, ".info/connected"), (snap) => {
            if (snap.val() === true) {
                light.style.backgroundColor = "#2ecc71";
                light.style.boxShadow = "0 0 15px #2ecc71";
                text.innerText = "SOVEREIGN LINK ACTIVE";
                logToChat("SYS", "LINK ESTABLISHED TO FIREBASE");
            } else {
                light.style.backgroundColor = "red";
                text.innerText = "LINK SEVERED";
            }
        });

        // Ø¯ÙˆØ§Ù„ Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù„Ø­Ø¸ÙŠ Ù„Ù„ÙˆØ§Ø¬Ù‡Ø©
        window.updateProgressPulse = (ratio) => {
            const p = Math.floor(ratio * 100);
            document.getElementById('percent').innerText = p + "%";
        };

        window.updateRotaryVisual = (tick) => {
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø±Ù‚Ù…ÙŠ Ø¨Ø§Ù„Ù€ TICK Ø§Ù„Ø­Ø§Ù„ÙŠ
            mainCounter.innerText = tick.toString().padStart(6, '0');
        };

        // Ø§Ù„Ø±Ø§Ø¯Ø§Ø± (Ø§Ù„Ø±Ø³Ù… Ø§Ù„Ù…Ø¨Ø§Ø´Ø±)
        const canvas = document.getElementById('radar-canvas');
        const ctx = canvas.getContext('2d');
        window.drawToCanvas = (buffer) => {
            if (!buffer) return;
            const side = Math.ceil(Math.sqrt(buffer.length));
            canvas.width = canvas.height = side;
            const imageData = ctx.createImageData(side, side);
            
            for (let i = 0; i < buffer.length; i++) {
                const val = buffer[i];
                const idx = i * 4;
                imageData.data[idx] = 0;       // R
                imageData.data[idx+1] = val;   // G (Ø£Ø®Ø¶Ø± Ø±Ø§Ø¯Ø§Ø±ÙŠ)
                imageData.data[idx+2] = 0;       // B
                imageData.data[idx+3] = 255;   // A
            }
            ctx.putImageData(imageData, 0, 0);
        };

        // Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø³Ø¬Ù„
        function logToChat(tag, msg) {
            const box = document.getElementById('chat-box');
            const time = new Date().toLocaleTimeString().split(' ')[0];
            box.innerHTML += `<div><span style="color:#555">[${time}]</span> <span style="color:#fff">${tag}:</span> ${msg}</div>`;
            box.scrollTop = box.scrollHeight;
        }
        window.logToChat = logToChat; // Ø¬Ø¹Ù„Ù‡Ø§ Ù…ØªØ§Ø­Ø© Ù„Ù„Ù…Ø³ØªÙ‚Ø¨Ù„

        // Ø§Ù„ØªØ­ÙƒÙ…
        document.getElementById('sendBtn').onclick = () => {
            const file = document.getElementById('fileInput').files[0];
            if (file) {
                logToChat("CORE", `STARTING TRANSMISSION: ${file.name}`);
                QUP_Core.transmit(file);
            } else {
                alert("ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ù…Ù„Ù Ø£ÙˆÙ„Ø§Ù‹");
            }
        };

        document.getElementById('clearBtn').onclick = async () => {
            if(confirm("ØªØ¯Ù…ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø³Ø­Ø§Ø¨ÙŠØ©ØŸ")) {
                await remove(streamRef);
                logToChat("SYS", "CLOUD STORAGE PURGED");
            }
        };

        document.getElementById('resetUI').onclick = () => location.reload();

        // ØªÙØ¹ÙŠÙ„ Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„Ù„Ø­Ø¸ÙŠØ© Ø¹Ù†Ø¯ Ø§ÙƒØªÙ…Ø§Ù„ Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…
        window.materializeInUI = (blob, name) => {
            const url = URL.createObjectURL(blob);
            const isVideo = name.toLowerCase().match(/\.(mp4|webm|ogg)$/);
            
            document.getElementById('tv-placeholder').style.display = 'none';
            if (isVideo) {
                const v = document.getElementById('tv-video');
                v.src = url; v.style.display = 'block';
                document.getElementById('tv-image').style.display = 'none';
            } else {
                const img = document.getElementById('tv-image');
                img.src = url; img.style.display = 'block';
                document.getElementById('tv-video').style.display = 'none';
            }
            logToChat("RCVR", `MATERIALIZATION COMPLETE: ${name}`);
        };
    </script>
</body>
</html>
