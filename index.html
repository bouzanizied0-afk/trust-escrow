<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>QUP Command Center - Sovereign Edition</title>
    <style>
        body {
            margin: 0; background-color: #050505; color: #2ecc71;
            font-family: 'Courier New', monospace;
            display: flex; flex-direction: column; align-items: center; height: 100vh; overflow: hidden;
        }
        .status-bar {
            width: 100%; padding: 10px; background: #111;
            display: flex; justify-content: center; align-items: center; gap: 30px;
            border-bottom: 2px solid #222; font-size: 0.8rem;
        }
        .status-item { display: flex; align-items: center; gap: 8px; }
        .led { width: 12px; height: 12px; border-radius: 50%; background: #330000; transition: 0.5s; border: 1px solid #000; }
        
        #main-counter {
            font-size: 5rem; font-weight: bold; margin: 10px 0;
            text-shadow: 0 0 20px #2ecc71; color: #39ff14;
        }
        .container {
            display: grid; grid-template-columns: 1fr 380px;
            gap: 15px; width: 98%; height: 75vh;
        }
        .display-unit {
            background: #000; border: 2px solid #2ecc71; position: relative;
            display: flex; align-items: center; justify-content: center; overflow: hidden;
        }
        #radar-canvas { position: absolute; width: 100%; height: 100%; opacity: 0.3; z-index: 1; }
        #tv-image, #tv-video { max-width: 95%; max-height: 95%; display: none; z-index: 5; border: 1px solid #2ecc71; }

        .panel { display: flex; flex-direction: column; gap: 10px; height: 100%; }
        #chat-box {
            flex-grow: 1; background: rgba(0,15,0,0.9); border: 1px solid #2ecc71;
            padding: 10px; font-size: 0.85rem; overflow-y: auto; color: #39ff14;
        }
        .chat-input-area { display: flex; gap: 5px; }
        #chatInput { 
            flex-grow: 1; background: #000; border: 1px solid #2ecc71; color: #39ff14; padding: 8px; outline: none;
        }
        .btn-group { display: grid; grid-template-columns: 1fr 1fr; gap: 5px; }
        button {
            padding: 12px; cursor: pointer; border: none; font-weight: bold;
            background: #2ecc71; color: #000;
        }
        .btn-danger { background: #e74c3c; color: white; margin-top: auto; }
    </style>
</head>
<body>

    <div class="status-bar">
        <div class="status-item">
            <div id="led-fb" class="led"></div> <span>FIREBASE</span>
        </div>
        <div class="status-item">
            <div id="led-core" class="led"></div> <span>QUP_CORE.js</span>
        </div>
        <div class="status-item">
            <div id="led-rcv" class="led"></div> <span>RECEIVER.js</span>
        </div>
    </div>

    <div id="main-counter">000000</div>

    <div class="container">
        <div class="display-unit">
            <canvas id="radar-canvas"></canvas>
            <img id="tv-image">
            <video id="tv-video" controls autoplay></video>
        </div>

        <div class="panel">
            <div id="chat-box">>> Ø¬Ø§Ø±ÙŠ ÙØ­Øµ ØªÙƒØ§Ù…Ù„ Ø§Ù„Ù†Ø¸Ø§Ù…...</div>
            <div class="chat-input-area">
                <input type="text" id="chatInput" placeholder="Ø§Ù„Ù†Ø¸Ø§Ù… Ù…Ù‚ÙÙ„...">
                <button id="sendMsgBtn">Ø¥Ø±Ø³Ø§Ù„</button>
            </div>
            
            <input type="file" id="fileInput" style="display: none;">
            <div class="btn-group">
                <button onclick="document.getElementById('fileInput').click()">ğŸ“‚ Ø§Ø®ØªÙŠØ§Ø± Ù…Ù„Ù</button>
                <button id="sendBtn" style="background: #39ff14;">ğŸš€ Ø¨Ø« Ø§Ù„Ù†Ø¨Ø¶Ø©</button>
            </div>
            <button class="btn-danger" id="clearBtn">ğŸ’€ ØªØ¯Ù…ÙŠØ± Ø§Ù„Ø³Ø­Ø§Ø¨</button>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-database.js";

        // Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyAZs0bb_t-bzMtaJqy_W_QDBSdQKHLEiD4",
            authDomain: "ziedzizou-7b74d.firebaseapp.com",
            databaseURL: "https://ziedzizou-7b74d-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "ziedzizou-7b74d",
            storageBucket: "ziedzizou-7b74d.firebasestorage.app",
            messagingSenderId: "937969676323",
            appId: "1:937969676323:web:8c89472de068a2e6cd0196",
            measurementId: "G-WQR9DXYGPS"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
        
        // Ø±Ø¨Ø· Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª Ø¹Ø§Ù„Ù…ÙŠØ§Ù‹ Ù„ÙƒÙŠ ØªØ³ØªØ®Ø¯Ù…Ù‡Ø§ Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ø®Ø§Ø±Ø¬ÙŠØ© ÙÙ‚Ø·
        window.db = db;
        window.counter = document.getElementById('main-counter');

        const ledFb = document.getElementById('led-fb');
        const ledCore = document.getElementById('led-core');
        const ledRcv = document.getElementById('led-rcv');

        // 1. ÙØ­Øµ Ø§ØªØµØ§Ù„ ÙÙŠØ±Ø¨Ø§ÙŠØ³ Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ
        onValue(ref(db, ".info/connected"), (snap) => {
            if (snap.val() === true) {
                ledFb.style.background = "#2ecc71";
                ledFb.style.boxShadow = "0 0 10px #2ecc71";
            } else {
                ledFb.style.background = "red";
            }
        });

        // 2. Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ø®Ø§Ø±Ø¬ÙŠØ© (Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø³ØªÙ…ÙˆØª Ø¨Ø¯ÙˆÙ†Ù‡Ø§)
        try {
            // Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ Ù…Ø­Ø±Ùƒ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„
            import('./QUP_Core.js').then(module => {
                window.QUP_Core = module.QUP_Core;
                ledCore.style.background = "#2ecc71";
                ledCore.style.boxShadow = "0 0 10px #2ecc71";
                // ØªÙØ¹ÙŠÙ„ Ø²Ø± Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ ÙÙ‚Ø· Ø¹Ù†Ø¯ Ù†Ø¬Ø§Ø­ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„Ù
                document.getElementById('sendBtn').onclick = () => {
                    const file = document.getElementById('fileInput').files[0];
                    if (file) window.QUP_Core.transmit(file);
                };
            }).catch(() => { ledCore.style.background = "red"; });

            // Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ Ù…Ø­Ø±Ùƒ Ø§Ù„Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ ÙˆØ§Ù„Ø¯Ø±Ø¯Ø´Ø© Ø§Ù„Ø®Ø§Ø±Ø¬ÙŠ
            import('./QUP_Receiver_Ultimate.js').then(module => {
                ledRcv.style.background = "#2ecc71";
                ledRcv.style.boxShadow = "0 0 10px #2ecc71";
                // Ù‡Ù†Ø§ ÙŠÙØªØ±Ø¶ Ø£Ù† Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø®Ø§Ø±Ø¬ÙŠ Ù‡Ùˆ Ù…Ù† ÙŠØ¯ÙŠØ± Ø¯Ø§Ù„Ø© Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ ÙˆØ§Ù„Ø¯Ø±Ø¯Ø´Ø©
            }).catch(() => { ledRcv.style.background = "red"; });

        } catch(e) { console.error("Integrity Error"); }

        // Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„ØµÙˆØ± Ù„Ù„Ù…Ø±Ø³Ù„ ÙÙ‚Ø· (Ù…Ø­Ù„ÙŠ)
        document.getElementById('fileInput').onchange = (e) => {
            const file = e.target.files[0];
            if (file) {
                const url = URL.createObjectURL(file);
                document.getElementById('tv-image').src = url;
                document.getElementById('tv-image').style.display = "block";
            }
        };
    </script>
</body>
</html>
