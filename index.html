<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QUP TEST CONSOLE</title>
    <style>
        body { background: #050505; color: #00f2ff; font-family: monospace; display: flex; flex-direction: column; align-items: center; padding: 20px; }
        .test-panel { border: 1px solid #00f2ff; padding: 20px; width: 350px; text-align: center; box-shadow: 0 0 15px #00f2ff; }
        #rotaryCounter { font-size: 2rem; margin: 20px 0; color: #00ff41; }
        #messages { height: 200px; width: 100%; border: 1px solid #333; margin-top: 10px; overflow-y: auto; text-align: right; padding: 5px; font-size: 0.8rem; background: #000; }
        input { background: #000; border: 1px solid #00f2ff; color: #00ff41; padding: 10px; width: 80%; margin-bottom: 10px; }
        button { background: #00f2ff; color: #000; border: none; padding: 10px 20px; cursor: pointer; font-weight: bold; }
    </style>
</head>
<body>

    <div class="test-panel">
        <h3>QUP DEBUGGER</h3>
        
        <div id="rotaryCounter">0</div>
        
        <input type="text" id="msgInput" placeholder="اكتب رسالة تجريبية...">
        <button id="sendMsgBtn">بث الرسالة</button>

        <div id="messages"></div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getDatabase, ref, onValue, set } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyAZs0bb_t-bzMtaJqy_W_QDBSdQKHLEiD4",
            authDomain: "ziedzizou-7b74d.firebaseapp.com",
            databaseURL: "https://ziedzizou-7b74d-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "ziedzizou-7b74d",
            storageBucket: "ziedzizou-7b74d.firebasestorage.app",
            messagingSenderId: "937969676323",
            appId: "1:937969676323:web:8c89472de068a2e6cd0196"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
        const pulseRef = ref(db, 'qup_pulses');

        window.fbSet = set;
        window.streamRef = pulseRef;

        // وظائف الواجهة المربوطة بالأكواد (المحرك والمستقبل)
        window.updateRotaryVisual = (tick) => {
            document.getElementById('rotaryCounter').innerText = tick;
        };

        window.logToChat = (msg) => {
            const m = document.getElementById('messages');
            m.innerHTML += `<div>> ${msg}</div>`;
            m.scrollTop = m.scrollHeight;
        };

        // التنصت على فيرباس وتمرير النبضات للمستقبل
        onValue(pulseRef, (snapshot) => {
            const data = snapshot.val();
            if (data && window.processIncomingPulse) {
                window.processIncomingPulse(data);
            }
        });

        // زر البث اليدوي لاختبار الاتصال
        document.getElementById('sendMsgBtn').onclick = () => {
            const input = document.getElementById('msgInput');
            if(input.value) {
                // إرسال كبيانات نصية بسيطة (SYNC) لاختبار المستقبل
                set(pulseRef, { t: 'CHAT', msg: input.value });
                input.value = "";
            }
        };
    </script>

    <script src="mouhark.js"></script>
    <script src="mostaqbel.js"></script>

</body>
</html>
