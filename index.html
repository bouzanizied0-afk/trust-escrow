<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>QUP Command Center - Ultra Stable</title>
    <style>
        body {
            margin: 0; background-color: #050505; color: #2ecc71;
            font-family: 'Courier New', monospace;
            display: flex; flex-direction: column; align-items: center; height: 100vh;
        }
        /* Ù…Ø¤Ø´Ø± Ø§Ù„Ø§ØªØµØ§Ù„ Ø§Ù„Ø¹Ù„ÙˆÙŠ */
        .status-bar {
            width: 100%; padding: 10px; background: #111;
            display: flex; justify-content: center; align-items: center; gap: 15px;
            border-bottom: 2px solid #222;
        }
        #status-light {
            width: 20px; height: 20px; border-radius: 50%; background-color: red;
            box-shadow: 0 0 10px red; transition: 0.5s;
        }
        /* Ø§Ù„Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø±Ù‚Ù…ÙŠ Ø§Ù„Ø¶Ø®Ù… */
        #main-counter {
            font-size: 6rem; font-weight: bold; margin: 20px 0;
            text-shadow: 0 0 20px #2ecc71; color: #39ff14;
        }
        .container {
            display: grid; grid-template-columns: 1fr 350px;
            gap: 20px; width: 95%; height: 60vh;
        }
        /* Ø´Ø§Ø´Ø© Ø§Ù„Ø±Ø§Ø¯Ø§Ø± ÙˆØ§Ù„Ù…ÙŠØ¯ÙŠØ§ */
        .display-unit {
            background: #000; border: 2px solid #2ecc71; position: relative;
            display: flex; align-items: center; justify-content: center; overflow: hidden;
        }
        #radar-canvas { position: absolute; width: 100%; height: 100%; opacity: 0.5; z-index: 1; }
        #tv-image, #tv-video { max-width: 90%; max-height: 90%; display: none; z-index: 5; border: 1px solid #2ecc71; }

        /* Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… ÙˆØ§Ù„Ø±Ø³Ø§Ø¦Ù„ */
        .panel { display: flex; flex-direction: column; gap: 10px; }
        #log-box {
            flex-grow: 1; background: rgba(0,20,0,0.9); border: 1px solid #2ecc71;
            padding: 10px; font-size: 0.8rem; overflow-y: auto; color: #2ecc71;
        }
        .btn-group { display: grid; grid-template-columns: 1fr 1fr; gap: 5px; }
        button {
            padding: 15px; cursor: pointer; border: none; font-weight: bold;
            background: #2ecc71; color: #000; transition: 0.3s;
        }
        button:hover { background: #39ff14; }
        .btn-danger { background: #e74c3c; color: white; }
    </style>
</head>
<body>

    <div class="status-bar">
        <div id="status-light"></div>
        <span id="status-text">Ø¬Ø§Ø±ÙŠ Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„Ù†Ø¨Ø¶Ø§Øª...</span>
    </div>

    <div id="main-counter">000000</div>

    <div class="container">
        <div class="display-unit">
            <canvas id="radar-canvas"></canvas>
            <img id="tv-image">
            <video id="tv-video" controls autoplay></video>
        </div>

        <div class="panel">
            <div id="log-box">>> Ù†Ø¸Ø§Ù… QUP Ø¬Ø§Ù‡Ø² Ù„Ù„Ø¨Ø«...</div>
            <input type="file" id="fileInput" style="display: none;">
            <div class="btn-group">
                <button onclick="document.getElementById('fileInput').click()">ğŸ“‚ Ø§Ø®ØªÙŠØ§Ø± Ù…Ù„Ù</button>
                <button id="sendBtn" style="background: #39ff14;">ğŸš€ Ø¨Ø« Ø§Ù„Ù†Ø¨Ø¶Ø©</button>
            </div>
            <button class="btn-danger" id="clearBtn">ğŸ’€ ØªØ¯Ù…ÙŠØ± Ø§Ù„Ø³Ø­Ø§Ø¨</button>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getDatabase, ref, onValue, set, remove } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyAZs0bb_t-bzMtaJqy_W_QDBSdQKHLEiD4",
            authDomain: "ziedzizou-7b74d.firebaseapp.com",
            databaseURL: "https://ziedzizou-7b74d-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "ziedzizou-7b74d",
            storageBucket: "ziedzizou-7b74d.firebasestorage.app",
            messagingSenderId: "937969676323",
            appId: "1:937969676323:web:8c89472de068a2e6cd0196",
            measurementId: "G-WQR9DXYGPS"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
        const streamRef = ref(db, 'QUP_UNIVERSAL_STREAM');

        const light = document.getElementById('status-light');
        const text = document.getElementById('status-text');
        const counter = document.getElementById('main-counter');
        const logBox = document.getElementById('log-box');

        // --- Ù†Ø¸Ø§Ù… Ø§Ù„Ø§ØªØµØ§Ù„ Ø§Ù„ÙÙˆØ±ÙŠ (Ù†ÙØ³ Ù…Ù†Ø·Ù‚ ÙƒÙˆØ¯Ùƒ Ø§Ù„Ù†Ø§Ø¬Ø­) ---
        onValue(ref(db, ".info/connected"), (snap) => {
            if (snap.val() === true) {
                light.style.backgroundColor = "#2ecc71";
                light.style.boxShadow = "0 0 20px #2ecc71";
                text.innerText = "Ù…ØªØµÙ„ Ø¨Ù†Ø¸Ø§Ù… Zied Zizou Ø§Ù„Ø³ÙŠØ§Ø¯ÙŠ";
                addToLog("SYSTEM", "Ø§ØªØµØ§Ù„ Ø¢Ù…Ù† ÙˆÙ…Ø³ØªÙ‚Ø±");
            } else {
                light.style.backgroundColor = "red";
                text.innerText = "Ø§Ù†Ù‚Ø·Ø¹ Ø§Ù„Ø§ØªØµØ§Ù„";
            }
        });

        function addToLog(tag, msg) {
            logBox.innerHTML += `<div>[${tag}]: ${msg}</div>`;
            logBox.scrollTop = logBox.scrollHeight;
        }

        // --- Ù…Ø­Ø±Ùƒ QUP CORE Ø§Ù„Ù…Ø¯Ù…Ø¬ Ù„Ø¶Ù…Ø§Ù† Ø§Ù„Ø§Ø³ØªÙ‚Ø±Ø§Ø± ---
        const QUP_Core = {
            async transmit(file) {
                const rawData = new Uint8Array(await file.arrayBuffer());
                const sid = Date.now();
                const seed = Math.random();
                
                addToLog("CORE", "ØªÙˆÙ„ÙŠØ¯ Ø·Ø¨Ù‚Ø© Ø§Ù„Ø´Ø¨Ø­...");
                await set(streamRef, { t: 'GENESIS', name: file.name, size: rawData.length, seed, sid });

                const layers = [8, 4, 2, 1];
                for (let step of layers) {
                    await this.stream(rawData, step, sid, seed);
                }
                await set(streamRef, { t: 'TERMINATE', sid });
                addToLog("CORE", "Ø§ÙƒØªÙ…Ù„ Ø§Ù„Ø¨Ø« Ø§Ù„Ø°Ø±ÙŠ");
            },
            async stream(data, step, sid, seed) {
                for (let i = 0; i < data.length; i += step) {
                    if (i % 500 === 0) {
                        counter.innerText = i.toString().padStart(6, '0');
                        await set(streamRef, { d: `${i}:${data[i]}`, t: 'DATA', sid });
                    }
                }
            }
        };

        // --- Ù…Ø­Ø±Ùƒ Ø§Ù„Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ ÙˆØ§Ù„Ø±Ø§Ø¯Ø§Ø± ---
        onValue(streamRef, (snap) => {
            const data = snap.val();
            if (!data) return;
            if (data.t === 'DATA') {
                counter.innerText = data.d.split(':')[0].padStart(6, '0');
                drawRadar();
            }
        });

        function drawRadar() {
            const canvas = document.getElementById('radar-canvas');
            const ctx = canvas.getContext('2d');
            ctx.fillStyle = "rgba(46, 204, 113, 0.1)";
            ctx.fillRect(Math.random()*canvas.width, Math.random()*canvas.height, 5, 5);
        }

        // ØªØ´ØºÙŠÙ„ Ø§Ù„Ø£Ø²Ø±Ø§Ø±
        document.getElementById('sendBtn').onclick = () => {
            const file = document.getElementById('fileInput').files[0];
            if (file) QUP_Core.transmit(file);
        };

        document.getElementById('clearBtn').onclick = () => {
            remove(streamRef);
            addToLog("SYS", "ØªÙ… ØªØ¯Ù…ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª");
            counter.innerText = "000000";
        };

    </script>
</body>
</html>
